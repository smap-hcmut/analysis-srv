# ==============================================================================
# Analytics Engine - Environment Configuration
# ==============================================================================
# Copy this file to .env and update values for your environment
# cp .env.example .env

# ==============================================================================
# Database Configuration
# ==============================================================================
DATABASE_URL=postgresql+asyncpg://dev:dev123@localhost:5432/analytics_dev
DATABASE_URL_SYNC=postgresql://dev:dev123@localhost:5432/analytics_dev
DATABASE_POOL_SIZE=20
DATABASE_MAX_OVERFLOW=10

# ==============================================================================
# Service Configuration
# ==============================================================================
SERVICE_NAME=analytics-engine
SERVICE_VERSION=0.1.0

# ==============================================================================
# Logging Configuration
# ==============================================================================
LOG_LEVEL=INFO
DEBUG=false

# ==============================================================================
# PhoBERT Model Configuration
# ==============================================================================
# Path to PhoBERT ONNX model directory
PHOBERT_MODEL_PATH=infrastructure/phobert/models
# Maximum sequence length for PhoBERT (default: 128)
PHOBERT_MAX_LENGTH=128
# Model file name (default: model_quantized.onnx)
PHOBERT_MODEL_FILE=model_quantized.onnx

# ==============================================================================
# SpaCy-YAKE Keyword Extraction Configuration
# ==============================================================================
# SpaCy model to use (default: xx_ent_wiki_sm - multilingual, recommended)
# Note: Vietnamese models (vi_core_news_*) are community-built and may not work
# with spaCy 3.8.11. The code will automatically fallback if unavailable.
SPACY_MODEL=xx_ent_wiki_sm

# YAKE language code (default: vi for Vietnamese)
YAKE_LANGUAGE=vi
# Maximum n-gram size for YAKE (default: 2)
YAKE_N=2
# Deduplication limit for YAKE (default: 0.8)
YAKE_DEDUP_LIM=0.8
# Maximum keywords to extract with YAKE (default: 30)
YAKE_MAX_KEYWORDS=30

# Maximum total keywords to return (default: 30)
MAX_KEYWORDS=30
# Weight for named entities in keyword scoring (default: 0.7)
ENTITY_WEIGHT=0.7
# Weight for noun chunks in keyword scoring (default: 0.5)
CHUNK_WEIGHT=0.5

# ==============================================================================
# Aspect Mapping Configuration
# ==============================================================================
# Enable aspect mapping for keywords (default: false)
# Set to true to enable hybrid keyword extraction with aspect categorization
ENABLE_ASPECT_MAPPING=false
# Path to aspect dictionary YAML file (default: config/aspects.yaml)
ASPECT_DICTIONARY_PATH=config/aspects.yaml
# Label for unknown/unmapped aspects (default: UNKNOWN)
UNKNOWN_ASPECT_LABEL=UNKNOWN

# ==============================================================================
# Text Preprocessor Configuration
# ==============================================================================
# Minimum text length after normalization (default: 10)
# Posts shorter than this will be flagged as too_short in stats
PREPROCESSOR_MIN_TEXT_LENGTH=10
# Maximum number of comments to include in merged content (default: 5)
PREPROCESSOR_MAX_COMMENTS=5

# ==============================================================================
# Intent Classifier Configuration
# ==============================================================================
# Enable intent classification (default: true)
INTENT_CLASSIFIER_ENABLED=true
# Confidence threshold for intent classification (default: 0.5)
INTENT_CLASSIFIER_CONFIDENCE_THRESHOLD=0.5
# Path to intent patterns YAML file (default: config/intent_patterns.yaml)
INTENT_PATTERNS_PATH=config/intent_patterns.yaml

# ==============================================================================
# RabbitMQ Configuration (Message Queue)
# ==============================================================================
# RabbitMQ connection URL
RABBITMQ_URL=amqp://guest:guest@localhost:5672/
# Queue name for analytics jobs
RABBITMQ_QUEUE_NAME=analytics_queue
# Prefetch count for message consumers (default: 1)
RABBITMQ_PREFETCH_COUNT=1

# ==============================================================================
# MinIO Configuration (Object Storage)
# ==============================================================================
# MinIO endpoint URL
MINIO_ENDPOINT=http://localhost:9000
# MinIO access key
MINIO_ACCESS_KEY=minioadmin
# MinIO secret key
MINIO_SECRET_KEY=minioadmin

# ==============================================================================
# Crawler Event Integration Configuration (Input)
# ==============================================================================
# Event exchange name for crawler events
EVENT_EXCHANGE=smap.events
# Routing key for data.collected events
EVENT_ROUTING_KEY=data.collected
# Queue name for analytics consumer
EVENT_QUEUE_NAME=analytics.data.collected

# ==============================================================================
# Result Publishing Configuration (Output)
# ==============================================================================
# Exchange name for publishing analyze results to Collector
PUBLISH_EXCHANGE=results.inbound
# Routing key for analyze results
PUBLISH_ROUTING_KEY=analyze.result
# Enable/disable result publishing (feature flag for gradual rollout)
PUBLISH_ENABLED=true

# ==============================================================================
# Batch Processing Configuration
# ==============================================================================
# Maximum concurrent batches to process
MAX_CONCURRENT_BATCHES=5
# Timeout for batch processing in seconds
BATCH_TIMEOUT_SECONDS=30
# Expected batch size for TikTok (default: 50)
EXPECTED_BATCH_SIZE_TIKTOK=50
# Expected batch size for YouTube (default: 20)
EXPECTED_BATCH_SIZE_YOUTUBE=20

# ==============================================================================
# MinIO Crawl Results Configuration
# ==============================================================================
# Bucket name for crawl results
MINIO_CRAWL_RESULTS_BUCKET=crawl-results

# ==============================================================================
# Error Handling Configuration
# ==============================================================================
# Maximum retries per item
MAX_RETRIES_PER_ITEM=3
# Base backoff time in seconds
ERROR_BACKOFF_BASE_SECONDS=1.0
# Maximum backoff time in seconds
ERROR_BACKOFF_MAX_SECONDS=60.0

# ==============================================================================
# Compression Configuration
# ==============================================================================
COMPRESSION_ENABLED=true
COMPRESSION_DEFAULT_LEVEL=2
COMPRESSION_ALGORITHM=zstd
COMPRESSION_MIN_SIZE_BYTES=1024

# ==============================================================================
# Impact & Risk Calculator Configuration
# ==============================================================================
# Interaction weights (EngagementScore)
IMPACT_WEIGHT_VIEW=0.01
IMPACT_WEIGHT_LIKE=1.0
IMPACT_WEIGHT_COMMENT=2.0
IMPACT_WEIGHT_SAVE=3.0
IMPACT_WEIGHT_SHARE=5.0

# Platform multipliers
IMPACT_PLATFORM_WEIGHT_TIKTOK=1.0
IMPACT_PLATFORM_WEIGHT_FACEBOOK=1.2
IMPACT_PLATFORM_WEIGHT_YOUTUBE=1.5
IMPACT_PLATFORM_WEIGHT_INSTAGRAM=1.1
IMPACT_PLATFORM_WEIGHT_UNKNOWN=1.0

# Sentiment amplifiers
IMPACT_AMP_NEGATIVE=1.5
IMPACT_AMP_NEUTRAL=1.0
IMPACT_AMP_POSITIVE=1.1

# Thresholds
IMPACT_VIRAL_THRESHOLD=70.0
IMPACT_KOL_FOLLOWER_THRESHOLD=50000
IMPACT_MAX_RAW_SCORE_CEILING=100000.0
